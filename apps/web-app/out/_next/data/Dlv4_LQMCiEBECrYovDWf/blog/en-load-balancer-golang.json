{"pageProps":{"posts":{"code":"var Component=(()=>{var p=Object.create;var s=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var k=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),f=(a,e)=>{for(var t in e)s(a,t,{get:e[t],enumerable:!0})},c=(a,e,t,l)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let i of m(e))!N.call(a,i)&&i!==t&&s(a,i,{get:()=>e[i],enumerable:!(l=u(e,i))||l.enumerable});return a};var v=(a,e,t)=>(t=a!=null?p(g(a)):{},c(e||!a||!a.__esModule?s(t,\"default\",{value:a,enumerable:!0}):t,a)),w=a=>c(s({},\"__esModule\",{value:!0}),a);var o=k((P,h)=>{h.exports=_jsx_runtime});var y={};f(y,{default:()=>d,frontmatter:()=>b});var n=v(o()),b={title:\"Build a Load Balancer from a scratch with Go\",date:\"2022-07-08\",cover:\"load-balancer.jpg\",isPublished:!0,description:\"A load balancer is a process of distributing incoming traffic across multiple targets.\",tags:[\"golang\",\"gateway\"]};function r(a){let e={a:\"a\",code:\"code\",div:\"div\",h2:\"h2\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",span:\"span\",ul:\"ul\",...a.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:`In the past, we have learned about, how to build a reverse proxy.\nToday we will learn another use case of reverse proxy which is a load balancer.\nTo get started i will assume you already know about docker and docker-compose`}),`\n`,(0,n.jsx)(e.p,{children:`There are several types of algorithms to distribute traffic in a load balance but for simplicity,\nwe will implement the round-robin algorithm, which is a dumb algorithm that goes to every single node one by one.`}),`\n`,(0,n.jsx)(e.h2,{id:\"store-backend\",children:\"Store Backend\"}),`\n`,(0,n.jsx)(e.p,{children:\"For the sake of simplicity, we will store all of the backends in a struct, which consists value of:\"}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsx)(e.li,{children:\"URL Host of internal backend\"}),`\n`,(0,n.jsx)(e.li,{children:\"Utility function of reverse proxy in go\"}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[`Both values in the Backend struct are a pointer,\nso the idea to store a value as a pointer because either `,(0,n.jsx)(e.code,{children:\"Url.Parse()\"}),\" or \",(0,n.jsx)(e.code,{children:\"NewSingleHostReverseProxy()\"}),`\nis returned a pointer too.`]}),`\n`,(0,n.jsx)(e.pre,{showlinenumbers:\"\",theme:\"orange\",children:(0,n.jsxs)(e.code,{className:\"language-go\",showlinenumbers:\"\",theme:\"orange\",children:[(0,n.jsxs)(e.div,{\"data-line\":\"1\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" Backend \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"2\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\tURL\t\t\t\t\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`URL\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"3\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\tReverseProxy \t\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"httputil\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`ReverseProxy\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"4\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"After that we need another struct, to store a pool of backend and counter to count visited backend by the index of the array.\"}),`\n`,(0,n.jsx)(e.pre,{showlinenumbers:\"\",theme:\"orange\",children:(0,n.jsxs)(e.code,{className:\"language-go\",showlinenumbers:\"\",theme:\"orange\",children:[(0,n.jsxs)(e.div,{\"data-line\":\"1\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" ServerPool \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"2\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\tBackends    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),`Backend\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"3\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\tcurrent     \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"uint64\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"4\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:`To add a reverse proxy we need to make a method from a ServerPool struct,\nthe method needs to be a pointer so it will be a reference to the backend struct memory address,\nso we can stored the data in memory.\nThere are 2 things we need to do before appending the server:`}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Parsing from raw string URL to a structure of URL.\"}),`\n`,(0,n.jsx)(e.li,{children:\"Create a new reverse proxy using NewSingleHostReverseProxy.\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Then we append the reverse proxy with an URL struct to Server Pool.\"}),`\n`,(0,n.jsx)(e.pre,{showlinenumbers:\"\",theme:\"orange\",children:(0,n.jsxs)(e.code,{className:\"language-go\",showlinenumbers:\"\",theme:\"orange\",children:[(0,n.jsxs)(e.div,{\"data-line\":\"1\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"bp \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"ServerPool\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"AddServer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"host \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"2\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\tserviceUrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Parse\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"host\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"3\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"4\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Fatal\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"5\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.div,{\"data-line\":\"6\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:`\n`}),(0,n.jsxs)(e.div,{\"data-line\":\"7\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\treverseProxy \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" httputil\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewSingleHostReverseProxy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"serviceUrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.div,{\"data-line\":\"8\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:`\n`}),(0,n.jsxs)(e.div,{\"data-line\":\"9\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\tbp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Backends \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"append\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"bp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Backends\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"Backend\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"10\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\tURL\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" serviceUrl\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"11\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\tReverseProxy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" reverseProxy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"12\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"13\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.h2,{id:\"visited-the-backend-node\",children:\"Visited the Backend Node\"}),`\n`,(0,n.jsx)(e.p,{children:`At this part, we want to implement visiting a server from Server Pool. Before that,\nwe need to count our visiting node index, so we can track where we are at our current position.`}),`\n`,(0,n.jsx)(e.p,{children:`Because under the hood HTTP request in golang is a concurrent operation,\nwe should use the synchronization method to increment the counter position, to avoid data race.\nThere are other methods that are cheap than locking for synchronization, which is an atomic operation.\nSo let's implement the method for increment index.`}),`\n`,(0,n.jsx)(e.p,{children:`In GetNextIndex method after we add the current index position,\nwe use modulus so the value is not greater than the maximum total of the backend available.\nThen for the current index position multiple by two is greater than a total of the backend minus one we reset it to zero.\nThe reason we do this way is that we want to compare it first then adding`}),`\n`,(0,n.jsx)(e.pre,{showlinenumbers:\"\",theme:\"orange\",children:(0,n.jsxs)(e.code,{className:\"language-go\",showlinenumbers:\"\",theme:\"orange\",children:[(0,n.jsxs)(e.div,{\"data-line\":\"1\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"bp \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"ServerPool\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"GetNextIndex\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"2\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"atomic\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"LoadUint64\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"bp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"current\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"bp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Backends\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"3\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\tatomic\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"StoreUint64\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"bp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"current\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"4\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.div,{\"data-line\":\"5\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:`\n`}),(0,n.jsxs)(e.div,{\"data-line\":\"6\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"atomic\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"AddUint64\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"bp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"current\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"uint64\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"%\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"uint64\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"bp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Backends\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"7\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"After tracking the position of the index, now we want to return our backend based on the position we already track.\"}),`\n`,(0,n.jsx)(e.pre,{showlinenumbers:\"\",theme:\"orange\",children:(0,n.jsxs)(e.code,{className:\"language-go\",showlinenumbers:\"\",theme:\"orange\",children:[(0,n.jsxs)(e.div,{\"data-line\":\"1\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"bp \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"ServerPool\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"GetNextServer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"Backend \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"2\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\tindex \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" bp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetNextIndex\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.div,{\"data-line\":\"3\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:`\n`}),(0,n.jsxs)(e.div,{\"data-line\":\"4\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" bp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Backends\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"5\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.h2,{id:\"prepare-a-http-handler\",children:\"Prepare a HTTP Handler\"}),`\n`,(0,n.jsx)(e.p,{children:`The first thing i want to do is to declare global variable from the struct then\nI want to call GetNextServer() from the serverPool struct to get the server,\nafter that serving the server using the serve method`}),`\n`,(0,n.jsx)(e.pre,{showlinenumbers:\"\",theme:\"orange\",children:(0,n.jsxs)(e.code,{className:\"language-go\",showlinenumbers:\"\",theme:\"orange\",children:[(0,n.jsxs)(e.div,{\"data-line\":\"1\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),` serverPool ServerPool\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"2\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"UsersLoadBalancer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"w http\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResponseWriter\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" r \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"http\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Request\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"3\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\tserver \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" serverPool\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetNextServer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.div,{\"data-line\":\"4\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:`\n`}),(0,n.jsxs)(e.div,{\"data-line\":\"5\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\tserver\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ReverseProxy\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ServeHTTP\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"w\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"6\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:`There are possibility the server is being down, so i want to make a global variable as initial valye\nto track how many servers we already visited, and if all servers are already being visited,\nthen we return HTTP error Service not Available.`}),`\n`,(0,n.jsx)(e.p,{children:`To store the total count we visit I want to use context value, it will passed to the HTTP request,\nand for each error from reverse proxy it will call the HTTP server again to serve the next server`}),`\n`,(0,n.jsx)(e.pre,{showlinenumbers:\"\",theme:\"orange\",children:(0,n.jsxs)(e.code,{className:\"language-go\",showlinenumbers:\"\",theme:\"orange\",children:[(0,n.jsxs)(e.div,{\"data-line\":\"1\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" Visit \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsx)(e.div,{\"data-line\":\"2\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:`\n`}),(0,n.jsxs)(e.div,{\"data-line\":\"3\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"GetVisitingNodeFromContext\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"r \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"http\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Request\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"4\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" visit\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" ok \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Context\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Value\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"Visit\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" ok \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"5\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),` visit\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"6\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.div,{\"data-line\":\"7\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:`\n`}),(0,n.jsxs)(e.div,{\"data-line\":\"8\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"9\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.div,{\"data-line\":\"10\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:`\n`}),(0,n.jsxs)(e.div,{\"data-line\":\"11\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"UsersLoadBalancerErrorHandler\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"w http\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ResponseWriter\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" r \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"http\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Request\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"12\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\tvisiting \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"GetVisitingNodeFromContext\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.div,{\"data-line\":\"13\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:`\n`}),(0,n.jsxs)(e.div,{\"data-line\":\"14\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" visiting \",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"serverPool\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Backends\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"15\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\thttp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Error\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"w\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Service not available\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" http\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"StatusServiceUnavailable\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"16\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"17\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.div,{\"data-line\":\"18\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:`\n`}),(0,n.jsxs)(e.div,{\"data-line\":\"19\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\tctx \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"WithValue\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Context\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Visit\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" visiting\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"20\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token function\",children:\"UsersLoadBalancer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"w\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"WithContext\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"21\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.h2,{id:\"finishing-the-server\",children:\"Finishing the server\"}),`\n`,(0,n.jsx)(e.p,{children:`To wrap up, We will use strings split which takes from the environment variable and separates each host with ';',\nafter that, we append every single backend to the server pool.\nIn the end, we started our HTTP server.`}),`\n`,(0,n.jsx)(e.pre,{showlinenumbers:\"\",theme:\"orange\",children:(0,n.jsxs)(e.code,{className:\"language-go\",showlinenumbers:\"\",theme:\"orange\",children:[(0,n.jsxs)(e.div,{\"data-line\":\"1\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"main\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"2\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\tusers \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" strings\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Split\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"os\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Getenv\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"USERS_SERVICE\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\";\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.div,{\"data-line\":\"3\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:`\n`}),(0,n.jsxs)(e.div,{\"data-line\":\"4\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" user \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"range\"}),\" users \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"5\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\tserverPool\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"AddServer\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"user\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"6\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.div,{\"data-line\":\"7\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:`\n`}),(0,n.jsxs)(e.div,{\"data-line\":\"8\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\thttp\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"HandleFunc\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"/\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" UsersLoadBalancer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.div,{\"data-line\":\"9\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:`\n`}),(0,n.jsxs)(e.div,{\"data-line\":\"10\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\tfmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Printf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Starting users service at port: %v\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" os\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Getenv\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"PORT\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"11\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" http\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ListenAndServe\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\":\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\"os\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Getenv\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"PORT\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"12\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token function\",children:\"panic\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"13\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.div,{\"data-line\":\"14\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.h2,{id:\"run-the-application\",children:\"Run the application\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"So to get started, we need to clone from \",(0,n.jsx)(e.a,{href:\"https://github.com/jerensl/reverse-proxy-gateway\",children:\"this\"}),\" repo and cd to the repository:\"]}),`\n`,(0,n.jsx)(e.pre,{theme:\"orange\",children:(0,n.jsx)(e.code,{className:\"language-bash\",theme:\"orange\",children:(0,n.jsxs)(e.div,{\"data-line\":\"1\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token function\",children:\"git\"}),` clone https://github.com/jerensl/reverse-proxy-gateway.git\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"After that, we need to run the reverse proxy and backend using docker-compose\"}),`\n`,(0,n.jsx)(e.pre,{theme:\"orange\",children:(0,n.jsx)(e.code,{className:\"language-bash\",theme:\"orange\",children:(0,n.jsxs)(e.div,{\"data-line\":\"1\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token function\",children:\"docker-compose\"}),` up\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"To test the reverse proxy we can use the curl command\"}),`\n`,(0,n.jsx)(e.pre,{theme:\"orange\",children:(0,n.jsx)(e.code,{className:\"language-bash\",theme:\"orange\",children:(0,n.jsxs)(e.div,{\"data-line\":\"1\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token function\",children:\"curl\"}),\" \",(0,n.jsx)(e.span,{className:\"token parameter variable\",children:\"-i\"}),` http://localhost:5000/\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"To check docker container id we can use this command\"}),`\n`,(0,n.jsx)(e.pre,{theme:\"orange\",children:(0,n.jsx)(e.code,{className:\"language-bash\",theme:\"orange\",children:(0,n.jsxs)(e.div,{\"data-line\":\"1\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token function\",children:\"docker\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"ps\"}),`\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"The last test is we can kill the server using docker command based on the server id\"}),`\n`,(0,n.jsx)(e.pre,{theme:\"orange\",children:(0,n.jsx)(e.code,{className:\"language-bash\",theme:\"orange\",children:(0,n.jsxs)(e.div,{\"data-line\":\"1\",className:\"highlight-line\",\"data-highlighted\":\"false\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token function\",children:\"docker\"}),` stop c95e20564e20\n`]})})}),`\n`,(0,n.jsx)(e.h2,{id:\"summary\",children:\"Summary\"}),`\n`,(0,n.jsx)(e.p,{children:\"Now we have already built our own load balancer, it turns out it is pretty easy to implement in golang, and the code is under 100 lines.\"}),`\n`,(0,n.jsx)(e.h2,{id:\"aditional\",children:\"Aditional\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/jerensl/reverse-proxy-gateway\",children:\"Revers Proxy Repositories\"})}),`\n`]})]})}function d(a={}){let{wrapper:e}=a.components||{};return e?(0,n.jsx)(e,{...a,children:(0,n.jsx)(r,{...a})}):r(a)}return w(y);})();\n;return Component;","frontmatter":{"title":"Build a Load Balancer from a scratch with Go","date":"2022-07-08","cover":"load-balancer.jpg","isPublished":true,"description":"A load balancer is a process of distributing incoming traffic across multiple targets.","tags":["golang","gateway"]},"metadata":{"slug":"en-load-balancer-golang","fileName":"en-load-balancer-golang.mdx","blurDataURL":null}},"blurDataURL":null,"currentYear":2025},"__N_SSG":true}